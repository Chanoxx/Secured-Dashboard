{# templates/admin/manage_products.html.twig #}
{% extends 'admin/base_admin.html.twig' %}

{% block admin_title %}Manage Products | Trailblaze Admin{% endblock %}

{% block admin_content %}

<div class="dashboard-header">
    <h1>Manage Products</h1>
    <p>Add, edit, or delete products displayed in the Trailblaze store.</p>
</div>

<div class="product-header">
    <h2>Existing Products</h2>

    <button class="add-btn" onclick="toggleAddForm()">
        Add Product
    </button>
</div>

<div id="addFormWrapper" class="add-product-form" style="display:none;">
    <h2>Add New Product</h2>

    {{ form_start(form, {'attr': {'enctype': 'multipart/form-data'}}) }}
        <div class="form-group">{{ form_row(form.itemName) }}</div>
        <div class="form-group">{{ form_row(form.description) }}</div>
        <div class="form-group">{{ form_row(form.price) }}</div>
        <div class="form-group">{{ form_row(form.quantity) }}</div>
        <div class="form-group">{{ form_row(form.imageFile) }}</div>

        <button type="submit" class="add-btn">Save Product</button>
    {{ form_end(form) }}
</div>

<section class="product-section">
    <div class="product-header" style="margin-top:20px;">
        <h2>Products</h2>
        <input type="text" id="productSearch" class="search-bar" placeholder="Search products..." onkeyup="filterProducts()">
    </div>

    <div class="shop-preview-grid" id="productGrid">
        {% for product in products %}
            <div class="shop-card">
                <div class="image-container">
                    <img src="{{ product.image ? asset('uploads/products/' ~ product.image) : asset('images/default-product.png') }}">
                </div>

                <h3 class="product-name">{{ product.itemName }}</h3>
                <p class="description">{{ product.description }}</p>
                <p class="price">â‚±{{ product.price|number_format(2) }}</p>
                <p class="stock">{{ product.quantity }} in stock</p>

                <div class="card-actions">
                    <a href="{{ path('admin_product_edit', {'id': product.id}) }}" class="btn-edit">Edit</a>

                    <form action="{{ path('admin_product_delete', {'id': product.id}) }}"
                          method="post"
                          onsubmit="return confirm('Are you sure?');">
                        <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ product.id) }}">
                        <button class="btn-delete">Delete</button>
                    </form>
                </div>
            </div>
        {% endfor %}
    </div>
</section>

<script>
function toggleAddForm() {
    const form = document.getElementById("addFormWrapper");
    form.style.display = form.style.display === "none" ? "block" : "none";
}

function filterProducts() {
    let filter = document.getElementById('productSearch').value.toLowerCase();
    let cards = document.querySelectorAll('#productGrid .shop-card');

    cards.forEach(card => {
        let values = card.innerText.toLowerCase();
        card.style.display = values.includes(filter) ? "" : "none";
    });
}
</script>

{% endblock %}
