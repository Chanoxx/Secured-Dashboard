{% extends 'base.html.twig' %}

{% block title %}Manage Products | Trailblaze Admin{% endblock %}

{% block stylesheets %}
<link rel="stylesheet" href="{{ asset('css/admin.css') }}">
{% endblock %}

{% block body %}
<div class="admin-container">

  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-logo">
      <img src="{{ asset('images/logo/Logo2.png') }}" alt="Trailblaze Logo">
      <h2>Trailblaze Admin</h2>
    </div>

    <ul>
      <li><a href="{{ path('admin_dashboard') }}">Dashboard</a></li>
      <li><a href="{{ path('admin_products') }}" class="active">Manage Products</a></li>
      <li><a href="{{ path('app_logout') }}">Logout</a></li>
    </ul>
  </aside>

  <!-- Main Content -->
  <main class="dashboard-content">
    <div class="dashboard-header">
      <h1>Manage Products </h1>
      <p>Add, edit, or delete products displayed in the Trailblaze store.</p>
    </div>

    <!-- Add Product Form -->
    <section class="product-section add-product-form">
      <h2>Add New Product</h2>
      {{ form_start(form, {'attr': {'enctype': 'multipart/form-data'}}) }}
        <div class="form-group">
          {{ form_label(form.itemName, 'Item Name') }}
          {{ form_widget(form.itemName) }}
        </div>

        <div class="form-group">
          {{ form_label(form.description, 'Description') }}
          {{ form_widget(form.description) }}
        </div>

        <div class="form-group">
          {{ form_label(form.price, 'Price') }}
          {{ form_widget(form.price) }}
        </div>

        <div class="form-group">
          {{ form_label(form.quantity, 'Quantity') }}
          {{ form_widget(form.quantity) }}
        </div>

        <div class="form-group">
          {{ form_label(form.imageFile, 'Product Image') }}
          {{ form_widget(form.imageFile) }}
        </div>

        <button type="submit" class="btn-edit">Save Product</button>
      {{ form_end(form) }}
    </section>

    <!-- Existing Products Section -->
    <section class="product-section">
      <div class="product-header">
        <h2>Existing Products</h2>
        <input 
          type="text" 
          id="productSearch" 
          class="search-bar" 
          placeholder="Search products..."
          onkeyup="filterProducts()"
        >
      </div>

      <div class="shop-preview-grid" id="productGrid">
        {% for product in products %}
          <div class="shop-card">
            <div class="image-container">
              <img src="{{ product.image ? asset('uploads/products/' ~ product.image) : asset('images/default-product.png') }}" alt="{{ product.itemName }}">
            </div>

            <h3 class="product-name">{{ product.itemName }}</h3>

{% if product.description %}
  <p class="description">
    {{ product.description|length > 100 ? product.description|slice(0, 100) ~ '...' : product.description }}
  </p>
{% else %}
  <p class="description text-muted">No description available.</p>
{% endif %}

<p class="price">â‚±{{ product.price|number_format(2, '.', ',') }}</p>
<p class="stock">{{ product.quantity }} in stock</p>


            <div class="action-buttons">
              <a href="{{ path('admin_product_edit', {'id': product.id}) }}" class="btn-edit">Edit</a>
              <form action="{{ path('admin_product_delete', {'id': product.id}) }}" method="post" style="display:inline-block;" onsubmit="return confirm('Are you sure you want to delete this product?');">
                <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ product.id) }}">
                <button class="btn-delete" type="submit">Delete</button>
              </form>
            </div>
          </div>
        {% else %}
          <p>No products found.</p>
        {% endfor %}
      </div>
    </section>

    <script>
function filterProducts() {
  const input = document.getElementById('productSearch');
  const filter = input.value.toLowerCase();
  const cards = document.querySelectorAll('#productGrid .shop-card');

  cards.forEach(card => {
    // Collect all searchable text inside the product card
    const text = card.innerText.toLowerCase(); 
    
    // Check if any part (name, price, quantity, description) matches
    if (text.includes(filter)) {
      card.style.display = '';
    } else {
      card.style.display = 'none';
    }
  });
}
</script>

  </main>
</div>
{% endblock %}
